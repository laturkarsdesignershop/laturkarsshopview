just make it simple

give me a complete php code 

use all the ref code and make a one php website : default.php






ref:




<?php
header('Content-Type: application/json');

// Database connection credentials
$host = "auth-db788.hstgr.io";
$database = "u777474409_ltmobileview";
$user = "u777474409_laturkarsmv";
$password = "LaturkarsMV@1234";

// Secret keys for API security
$secretKey1 = "thisis$!@$%Hostinger";
$secretKey2 = "Hostinger#123LatLong";

/**
 * Function: executeSqlQuery
 * IO: Accepts SQL query and secret keys via POST
 * Working: Validates secret keys, executes SQL, and returns JSON results
 */
function executeSqlQuery($host, $database, $user, $password, $secretKey1, $secretKey2) {
    try {
        // Validate secret keys from POST
        $postKey1 = $_POST['secretKey1'] ?? '';
        $postKey2 = $_POST['secretKey2'] ?? '';
        if ($postKey1 !== $secretKey1 || $postKey2 !== $secretKey2) {
            throw new Exception("Invalid secret keys.");
        }

        // Connect to MySQL
        $conn = new mysqli($host, $user, $password, $database);
        if ($conn->connect_error) {
            throw new Exception("Connection failed: " . $conn->connect_error);
        }

        // Get POSTed SQL query
        $sqlQuery = $_POST['sql'] ?? '';
        if (empty($sqlQuery)) {
            throw new Exception("No SQL query provided.");
        }

        // Execute query
        $result = $conn->query($sqlQuery);
        if ($result === false) {
            throw new Exception("Query error: " . $conn->error);
        }

        // Prepare output
        $output = [];
        if ($result instanceof mysqli_result) {
            while ($row = $result->fetch_assoc()) {
                $output[] = $row;
            }
        } else {
            // For INSERT/UPDATE/DELETE
            $output = ["affectedRows" => $conn->affected_rows];
        }

        $conn->close();

        echo json_encode([
            "success" => true,
            "data" => $output
        ]);
    } catch (Exception $error) {
        echo json_encode([
            "success" => false,
            "error" => $error->getMessage()
        ]);
    }
}

// Run the function
executeSqlQuery($host, $database, $user, $password, $secretKey1, $secretKey2);
?>




app.py:
import inspect
import traceback
from flask import Flask, render_template, request, redirect, url_for, session, flash, jsonify
import requests
from datetime import datetime
import os

app = Flask(__name__)
app.secret_key = "myStrongSecretKey456"

# =======================
# SQL POST Helper
# =======================
def postSqlQuery(sqlQuery):
    """Send SQL query via POST and return response as dict."""
    try:
        print(f"üîë Executing SQL: {sqlQuery}")
        r = requests.post(
            "https://darkviolet-mosquito-473241.hostingersite.com/default.php",
            data={
                "sql": sqlQuery,
                "secretKey1": "thisis$!@$%Hostinger",
                "secretKey2": "Hostinger#123LatLong"
            },
            timeout=40
        )
        r.raise_for_status()
        return r.json() if r.headers.get("Content-Type") == "application/json" else {"responseText": r.text}
    except requests.RequestException as e:
        print("‚ùå Error executing SQL:", e)
        print("Line:", traceback.extract_tb(e.__traceback__)[-1].lineno)
        return None

def executeQuery(sql, fetchAll=False, fetchOne=False):
    """Execute SQL using postSqlQuery."""
    try:
        result = postSqlQuery(sql)
        if not result or not result.get("success"):
            return None
        data = result.get("data", [])
        if fetchOne:
            return data[0] if data else None
        if fetchAll:
            return data
        return True
    except Exception as e:
        print(f"‚ùå executeQuery Error: {e}")
        print("Line:", traceback.extract_tb(e.__traceback__)[-1].lineno)
        return None

# =======================
# Utility Functions
# =======================
def convertDateFilter(inputDate):
    """Convert date from YYYY-MM-DD to DD-MM-YYYY."""
    try:
        if "-" not in inputDate:
            return inputDate
        parts = inputDate.split("-")
        if len(parts) != 3:
            raise ValueError("Invalid date format")
        year, month, day = parts
        return f"{day}-{month}-{year}"
    except Exception as err:
        print(f"Error Fun(convertDateFilter): {err}")
        print("Line:", traceback.extract_tb(err.__traceback__)[-1].lineno)
        return inputDate

app.jinja_env.filters["convertDate"] = convertDateFilter

# =======================
# Routes
# =======================
@app.route("/")
def homePage():
    """Render dashboard page."""
    try:
        return render_template("dashboard.html")
    except Exception as error:
        print("Line:", traceback.extract_tb(error.__traceback__)[-1].lineno)
        return jsonify({"error": str(error)}), 500

@app.route("/orders", methods=["GET", "POST"])
def listOrders():
    """List orders with optional filters."""
    try:
        keyword = request.args.get("keyword", "")
        page = int(request.args.get("page", 1))
        perPage = int(request.args.get("per_page", 10))
        todayDeliveries = []

        if request.method == "POST":
            keyword = request.form.get("keyword", "").strip()
            if keyword == "todaydeliveries":
                sqlToday = f"""
                    SELECT o.*, COALESCE(c.fullname, 'Unknown') AS customer_name,
                           COALESCE(c.phone, '') AS customer_phone,
                           COALESCE(c.mobile, '') AS customer_mobile
                    FROM tailor_order o
                    LEFT JOIN tailor_customers c ON o.id_customers = c.id_customers
                    WHERE o.delivery_date = '{datetime.today().date()}'
                    AND o.status != 'Deleted'
                    ORDER BY o.id_order DESC
                """
                todayDeliveries = executeQuery(sqlToday, fetchAll=True)
            elif keyword == "todayorders":
                sqlTodayOrd = f"""
                    SELECT o.*, COALESCE(c.fullname, 'Unknown') AS customer_name,
                           COALESCE(c.phone, '') AS customer_phone,
                           COALESCE(c.mobile, '') AS customer_mobile
                    FROM tailor_order o
                    LEFT JOIN tailor_customers c ON o.id_customers = c.id_customers
                    WHERE o.order_date LIKE '{datetime.today().date()}%'
                    AND o.status != 'Deleted'
                    ORDER BY o.id_order DESC
                """
                todayDeliveries = executeQuery(sqlTodayOrd, fetchAll=True)
            page = 1

        # Fetch orders for GET or POST keyword
        if not todayDeliveries:
            kw = f"%{keyword}%"
            offset = (page - 1) * perPage

            sqlCount = f"""
                SELECT COUNT(*) as total
                FROM tailor_order
                WHERE id_order LIKE '{kw}'
                AND status != 'Deleted'
            """
            # totalFiltered = executeQuery(sqlCount, fetchOne=True)["total"]
            totalFiltered = int(executeQuery(sqlCount, fetchOne=True)["total"])


            sqlPaged = f"""
                SELECT o.*, COALESCE(c.fullname, 'Unknown') AS customer_name,
                       COALESCE(c.phone, '') AS customer_phone,
                       COALESCE(c.mobile, '') AS customer_mobile
                FROM tailor_order o
                LEFT JOIN tailor_customers c ON o.id_customers = c.id_customers
                WHERE o.id_order LIKE '{kw}'
                AND o.status != 'Deleted'
                ORDER BY o.id_order DESC
                LIMIT {perPage} OFFSET {offset}
            """
            orders = executeQuery(sqlPaged, fetchAll=True)
        else:
            orders = todayDeliveries
            totalFiltered = len(todayDeliveries)

        # -------------------------
        # Batch fetch products & staff
        # -------------------------
        orderIds = [o["id_order"] for o in orders]
        productsSql = f"SELECT * FROM tailor_products WHERE id_order IN ({','.join(map(str, orderIds))})"
        allProducts = executeQuery(productsSql, fetchAll=True) or []

        orderProductMap = {oid: [] for oid in orderIds}
        staffIds = set()
        for p in allProducts:
            orderProductMap[p["id_order"]].append(p)
            if p.get("id_staff"):
                staffIds.add(p["id_staff"])
            if p.get("cutting_staff"):
                staffIds.add(p["cutting_staff"])

        staffMap = {}
        if staffIds:
            staffSql = f"SELECT id_staff, fullname FROM tailor_staff WHERE id_staff IN ({','.join(map(str, staffIds))}) AND status != 'Deleted'"
            staffData = executeQuery(staffSql, fetchAll=True) or []
            staffMap = {s['id_staff']: s['fullname'] for s in staffData}

        ordersWithStatuses = []
        for ordRow in orders:
            orderDict = dict(ordRow)
            orderDict["products"] = orderProductMap.get(orderDict["id_order"], [])
            cBill = float(orderDict.get("cloth_bill", 0.0))
            sBill = float(orderDict.get("stitching_bill", 0.0))
            advPay = float(orderDict.get("advance_payment", 0.0))
            orderDict["balAmt"] = round(cBill + sBill - advPay, 2)

            for p in orderDict["products"]:
                p["p_stitching_staff"] = staffMap.get(p.get("id_staff"), "-")
                p["p_cutting_staff"] = staffMap.get(p.get("cutting_staff"), "-")

                status = p.get("status", "").lower()
                if "cut" in status:
                    jobStatus = "Cutting"
                elif "sew" in status:
                    jobStatus = "Stitching"
                elif "waiting" in status:
                    jobStatus = "Ready"
                elif "delivered" in status or "new" in status:
                    jobStatus = status.upper()
                else:
                    jobStatus = status.upper()
                p["jobstatus"] = jobStatus

            ordersWithStatuses.append(orderDict)

        ordersWithStatuses.sort(key=lambda o: int(o["id_order"]), reverse=True)

        return render_template(
            "orders/orderlist.html",
            orders=ordersWithStatuses,
            content={
                "orderDatalen": totalFiltered,
                "orderlen": totalFiltered,
                "keyword": keyword,
                "mainadmin": "myadmin",
                "page": page,
                "totalPages": (totalFiltered + perPage - 1) // perPage,
                "perPage": len(orders),
                "test_keywords": ["todaydeliveries", "todayorders"]
            }
        )

    except Exception as e:
        print("‚ùå Error fetching orders:", e)
        tb = traceback.extract_tb(e.__traceback__)
        if tb:
            print("Error Line:", tb[-1].lineno)  # prints only the line number
        flash(f"Error fetching orders: {e}", "error")
        return redirect(url_for("homePage"))

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)


html code:
{% extends "base.html" %}

{% block title %}Orders - {{ session['platform'] }}{% endblock %}

{% block content %}

<!-- messages -->
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul class="mb-4">
  {% for message in messages %}
  <li class="bg-green-100 p-2 rounded text-gray-700 text-sm">{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}

<!-- Top Header -->
<div class="mb-3">
  <h1 class="text-md font-bold text-gray-900">Orders ({{ content.perPage }}/{{ content.orderlen }})</h1>

  {% if content.keyword %}
  <p class="text-xs text-gray-600 font-medium">Searched by {{ content.keyword }}</p>
  {% endif %}
</div>

<!-- Filter Dropdown -->
<form method="POST" class="mb-3">
  <select name="keyword" onchange="this.form.submit()" 
    class="w-full p-1 border border-gray-300 rounded focus:ring-indigo-600 focus:border-indigo-600 text-xs">
    <option value="">Filter Orders</option>
    {% for filter in content.test_keywords %}
      <option value="{{ filter }}">{{ filter | title }}</option>
    {% endfor %}
  </select>
</form>

<!-- Search -->
<form method="POST" action="{{ url_for('listOrders') }}" class="flex gap-1 mb-1">
  <input type="text" name="keyword" placeholder="Search orders..." value="{{ content.keyword }}"
    class="flex-1 p-2 border rounded-l-md text-sm focus:ring-indigo-600 focus:border-indigo-600">
  <button type="submit"
    class="px-3 py-2 rounded-r-md bg-indigo-600 text-white text-sm"><i class="fas fa-search"></i></button>
</form>


<!-- Order Cards -->
{% if orders %}
<div class="space-y-3">
  {% for o in orders %}
  <div class="bg-white border rounded-lg shadow p-1">

    <!-- Header Row -->
    <div class="flex justify-between items-center">
      <p class="text-sm font-bold"><i class="text-xs text-gray-600">Order: </i>{{ o.id_order }}</p>
      <span class="text-xs bg-yellow-800 text-white px-2 py-0.5 rounded font-bold">Bal Pay : Rs. {{ o.balAmt }}</span>
      <span class="text-xs bg-gray-800 text-white px-2 py-0.5 rounded">{% if o.payment_status %}{{ o.payment_status | title }}{% else %} Unknown {% endif %}</span>
    </div>

    <!-- Customer -->
    <p class="text-base font-semibold">{{ o.customer_name | title }}</p>
    <p class="text-sm text-gray-600">{{ o.customerMobile }} {{ o.customerPhone }}</p>

    <!-- Delivery Date -->
    <p class="text-sm font-medium text-blue-700">Delivery: 
      {% if o.delivery_date == None %}
        NONE
      {% else %}
        {{ o.delivery_date | convertDate }}</p>
      {% endif %}

    <!-- Items -->
    <div class="mt-2">
      <!-- <p class="text-xs font-semibold text-gray-700">Items</p> -->
      <ul class="text-xs text-gray-700">
        <div class="grid grid-cols-4 gap-1 bg-gray-200 rounded-sm font-bold">
          <div class="text-center">Item</div>
          <div class="text-center">Cut Staff</div>
          <div class="text-center">Stit Staff</div>
          <div class="text-center">Status</div>
        </div>
        {% for itm in o.products %}
        <!-- <div>{{itm}}</div> -->
        <div class="grid grid-cols-4 gap-1 pl-1">

          

          {% if itm.shirt_type != None %}
            <div>{{ loop.index }}. {{ itm.shirt_type | title }} x{{ itm.qty }}</div> 
            <div class="text-center">{{ itm.p_stitching_staff | title }}</div>
            <div class="text-center">{{ itm.p_cutting_staff | title }}</div> 

          {% else %}
            <div>{{ loop.index }}. {{ itm.pant_type | title }} x{{ itm.qty }} </div>
            <div class="text-center">{{ itm.p_stitching_staff | title }}</div> 
            <div class="text-center">{{ itm.p_cutting_staff | title }}</div>
          {% endif %}


          {% if "delivered" in itm.jobstatus | lower %}
            <div class="font-bold text-center rounded-md bg-blue-800 text-white text-xs">Delivered</div>
          {% elif "sew" in itm.jobstatus | lower or "stit" in itm.jobstatus | lower %}
            <div class="font-bold text-center rounded-md bg-yellow-900 text-white text-xs">Stitching 123</div>
          {% elif "cutting" in itm.jobstatus | lower %}
            <div class="font-bold text-center rounded-md bg-red-900 text-white text-xs">Cutting</div>
          {% elif "ready" in itm.jobstatus | lower %}
            <div class="font-bold text-center rounded-md bg-green-800 text-white text-xs">Ready</div>
          {% elif "new" in itm.jobstatus | lower %}
            <div class="font-bold text-center rounded-md bg-green-300  text-xs">New</div>
          {% else %}
            <div class="font-bold text-center rounded-md bg-gray-800 text-white text-xs">{{itm.jobstatus}}</div>
          {% endif %}


        </div>
        {% endfor %}
      </ul>
    </div>

    <!-- Job Status -->
    <div class="mt-2 flex flex-wrap gap-1">
      {% for itm in o.jobStatus %}
        {% set status = itm | lower %}
        {% if "cut" in status %}
          <span class="px-2 py-1 bg-red-600 text-white text-xs rounded">Cutting</span>
        {% elif "sew" in status %}
          <span class="px-2 py-1 bg-orange-600 text-white text-xs rounded">Stitching</span>
        {% elif "waiting" in status %}
          <span class="px-2 py-1 bg-green-700 text-white text-xs rounded">Ready</span>
        {% elif "delivered" in status %}
          <span class="px-2 py-1 bg-blue-700 text-white text-xs rounded">Delivered</span>
        {% else %}
          <span class="px-2 py-1 bg-gray-700 text-white text-xs rounded">{{ itm | title }}</span>
        {% endif %}
      {% endfor %}
    </div>

    <!-- Actions -->
    <div class="mt-3 flex justify-end hidden">
      <a href="/orders/view/{{ o.id_order }}" class="text-blue-600 text-sm font-semibold hover:underline">
        View Details ‚Üí
      </a>
    </div>

  </div>
  {% endfor %}
</div>
{% else %}
<p class="text-center py-4 text-gray-600">No orders found</p>
{% endif %}


<!-- Pagination -->
{% if content.totalPages > 1 %}
<div class="flex justify-between items-center text-sm mt-4">
  {% if content.page > 1 %}
  <a href="{{ url_for('listOrders', page=content.page-1, per_page=content.perPage, keyword=content.keyword) }}"
    class="px-3 py-1 rounded bg-gray-200 font-medium">‚Üê Prev</a>
  {% endif %}

  <span>Page {{ content.page }} / {{ content.totalPages }}</span>

  {% if content.page < content.totalPages %}
  <a href="{{ url_for('listOrders', page=content.page+1, per_page=content.perPage, keyword=content.keyword) }}"
    class="px-3 py-1 rounded bg-gray-200 font-medium">Next ‚Üí</a>
  {% endif %}
</div>
{% endif %}

{% endblock %}




